function _chkDHTM(n,t,i){t=n.document.body||null,jg_ie=t&&typeof t.insertAdjacentHTML!="undefined"&&n.document.createElement,jg_dom=t&&!jg_ie&&typeof t.appendChild!="undefined"&&typeof n.document.createRange!="undefined"&&typeof(i=n.document.createRange()).setStartBefore!="undefined"&&typeof i.createContextualFragment!="undefined",jg_fast=jg_ie&&n.document.all&&!n.opera,jg_moz=jg_dom&&typeof t.style.MozOpacity!="undefined",jg_ok=!!(jg_ie||jg_dom)}function _pntCnvDom(){var n=this.wnd.document.createRange();n.setStartBefore(this.cnv),n=n.createContextualFragment(jg_fast?this._htmRpc():this.htm),this.cnv&&this.cnv.appendChild(n),this.htm=""}function _pntCnvIe(){this.cnv&&this.cnv.insertAdjacentHTML("BeforeEnd",jg_fast?this._htmRpc():this.htm),this.htm=""}function _pntDoc(){this.wnd.document.write(jg_fast?this._htmRpc():this.htm),this.htm=""}function _pntN(){}function _mkDiv(n,t,i,r){this.htm+='<div style="position:absolute;left:'+n+"px;top:"+t+"px;width:"+i+"px;height:"+r+"px;clip:rect(0,"+i+"px,"+r+"px,0);background-color:"+this.color+(jg_moz?"":";overflow:hidden")+';"></div>'}function _mkDivIe(n,t,i,r){this.htm+="%%"+this.color+";"+n+";"+t+";"+i+";"+r+";"}function _mkDivPrt(n,t,i,r){this.htm+='<div style="position:absolute;border-left:'+i+"px solid "+this.color+";left:"+n+"px;top:"+t+"px;width:0px;height:"+r+"px;clip:rect(0,"+i+"px,"+r+"px,0);background-color:"+this.color+(jg_moz?"":";overflow:hidden")+';"></div>'}function _htmRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2px;top:$3px;width:$4px;height:$5px"></div>\n')}function _htmPrtRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2px;top:$3px;width:$4px;height:$5px;border-left:$4px solid $1"></div>\n')}function _mkLin(n,t,i,r){var y,p;n>i&&(y=i,p=r,i=n,r=t,n=y,t=p);var c=i-n,o=Math.abs(r-t),h=n,u=t,a=t>r?-1:1;if(c>=o){for(var s=o<<1,v=s-(c<<1),f=s-c,l=h;c>0;)--c,++h,f>0?(this._mkDiv(l,u,h-l,1),u+=a,f+=v,l=h):f+=s;this._mkDiv(l,u,i-l+1,1)}else{var s=c<<1,v=s-(o<<1),f=s-o,e=u;if(r<=t){while(o>0)--o,f>0?(this._mkDiv(h++,u,1,e-u+1),u+=a,f+=v,e=u):(u+=a,f+=s);this._mkDiv(i,r,1,e-r+1)}else{while(o>0)--o,u+=a,f>0?(this._mkDiv(h++,e,1,u-e),f+=v,e=u):f+=s;this._mkDiv(i,e,1,r-e+1)}}}function _mkLin2D(n,t,i,r){var b,k,f;n>i&&(b=i,k=r,i=n,r=t,n=b,t=k);var e=i-n,u=Math.abs(r-t),v=n,o=t,p=t>r?-1:1,s=this.stroke;if(e>=u){e>0&&s-3>0?(f=(s*e*Math.sqrt(1+u*u/(e*e))-e-(s>>1)*u)/e,f=(s-4?Math.round(f):Math.ceil(f))+1):f=s;for(var l=Math.ceil(s/2),a=u<<1,w=a-(e<<1),h=a-e,y=v;e>0;)--e,++v,h>0?(this._mkDiv(y,o,v-y+l,f),o+=p,h+=w,y=v):h+=a;this._mkDiv(y,o,i-y+l+1,f)}else{s-3>0?(f=(s*u*Math.sqrt(1+e*e/(u*u))-(s>>1)*e-u)/u,f=(s-4?Math.round(f):Math.ceil(f))+1):f=s;var l=Math.round(s/2),a=e<<1,w=a-(u<<1),h=a-u,c=o;if(r<=t){for(++l;u>0;)--u,h>0?(this._mkDiv(v++,o,f,c-o+l),o+=p,h+=w,c=o):(o+=p,h+=a);this._mkDiv(i,r,f,c-r+l)}else{while(u>0)--u,o+=p,h>0?(this._mkDiv(v++,c,f,o-c+l),h+=w,c=o):h+=a;this._mkDiv(i,c,f,r-c+l+1)}}}function _mkLinDott(n,t,i,r){var a,y;n>i&&(a=i,y=r,i=n,r=t,n=a,t=y);var s=i-n,o=Math.abs(r-t),h=n,c=t,v=t>r?-1:1,u=!0;if(s>=o)for(var e=o<<1,l=e-(s<<1),f=e-s;s>0;)--s,u&&this._mkDiv(h,c,1,1),u=!u,f>0?(c+=v,f+=l):f+=e,++h;else for(var e=s<<1,l=e-(o<<1),f=e-o;o>0;)--o,u&&this._mkDiv(h,c,1,1),u=!u,c+=v,f>0?(++h,f+=l):f+=e;u&&this._mkDiv(h,c,1,1)}function _mkOv(n,t,i,r){for(var a=++i>>1,e=++r>>1,w=i&1,b=r&1,v=n+a,k=t+e,f=0,u=e,d=0,h=e,l=a*a<<1,nt=l<<1,c=e*e<<1,g=c<<1,p=(l>>1)*(1-(e<<1))+c,y=(c>>1)-l*((e<<1)-1),s,o;u>0;)p<0?(p+=c*((f<<1)+3),y+=g*++f):y<0?(p+=c*((f<<1)+3)-nt*(u-1),y+=g*++f-l*((u--<<1)-3),s=f-d,o=h-u,s&2&&o&2?(this._mkOvQds(v,k,f-2,u+2,1,1,w,b),this._mkOvQds(v,k,f-1,u+1,1,1,w,b)):this._mkOvQds(v,k,f-1,h,s,o,w,b),d=f,h=u):(y-=l*((u<<1)-3),p-=nt*--u);s=a-d+1,o=(h<<1)+b,u=k-h,this._mkDiv(v-a,u,s,o),this._mkDiv(v+d+w-1,u,s,o)}function _mkOv2D(n,t,i,r){var o=this.stroke,p,u,vt,ut,at,h;i+=o+1,r+=o+1;var it=i>>1,c=r>>1,rt=i&1,k=r&1,w=n+it,b=t+c,f=0,e=c,g=it*it<<1,ct=g<<1,nt=c*c<<1,lt=nt<<1,l=(g>>1)*(1-(c<<1))+nt,a=(nt>>1)-g*((c<<1)-1);if(o-4<0&&(!(o-2)||i-51>0&&r-51>0)){for(p=0,u=c;e>0;)l<0?(l+=nt*((f<<1)+3),a+=lt*++f):a<0?(l+=nt*((f<<1)+3)-ct*(e-1),a+=lt*++f-g*((e--<<1)-3),vt=f-p,ut=u-e,vt-1?(at=vt+1+(o&1),ut=o):ut-1?(at=o,ut+=1+(o&1)):at=ut=o,this._mkOvQds(w,b,f-1,u,at,ut,rt,k),p=f,u=e):(a-=g*((e<<1)-3),l-=ct*--e);this._mkDiv(w-it,b-u,o,(u<<1)+k),this._mkDiv(w+it+rt-o,b-u,o,(u<<1)+k)}else{var pt=i-(o<<1)>>1,tt=r-(o<<1)>>1,ht=0,d=tt,ft=pt*pt<<1,bt=ft<<1,et=tt*tt<<1,wt=et<<1,st=(ft>>1)*(1-(tt<<1))+et,ot=(et>>1)-ft*((tt<<1)-1),y=[],v=[],s=[];for(y[0]=0,v[0]=c,s[0]=tt-1;e>0;)l<0?(y[y.length]=f,v[v.length]=e,l+=nt*((f<<1)+3),a+=lt*++f):a<0?(y[y.length]=f,l+=nt*((f<<1)+3)-ct*(e-1),a+=lt*++f-g*((e--<<1)-3),v[v.length]=e):(a-=g*((e<<1)-3),l-=ct*--e),d>0&&(st<0?(st+=et*((ht<<1)+3),ot+=wt*++ht,s[s.length]=d-1):ot<0?(st+=et*((ht<<1)+3)-bt*(d-1),ot+=wt*++ht-ft*((d--<<1)-3),s[s.length]=d-1):(ot-=ft*((d<<1)-3),st-=bt*--d,s[s.length-1]--));var p=-rt,u=c,yt=s[0],kt=y.length,vt,ut;for(h=0;h<kt;h++)typeof s[h]!="undefined"?(s[h]<yt||v[h]<u)&&(f=y[h],this._mkOvQds(w,b,f,u,f-p,u-yt,rt,k),p=f,u=v[h],yt=s[h]):(f=y[h],this._mkDiv(w-f,b-u,1,(u<<1)+k),this._mkDiv(w+p+rt,b-u,1,(u<<1)+k),p=f,u=v[h]);this._mkDiv(w-it,b-u,1,(u<<1)+k),this._mkDiv(w+p+rt,b-u,1,(u<<1)+k)}}function _mkOvDott(n,t,i,r){for(var a=++i>>1,f=++r>>1,b=i&1,y=r&1,k=y^1,w=n+a,d=t+f,e=0,u=f,s=a*a<<1,v=s<<1,o=f*f<<1,p=o<<1,h=(s>>1)*(1-(f<<1))+o,c=(o>>1)-s*((f<<1)-1),l=!0;u>0;)h<0?(h+=o*((e<<1)+3),c+=p*++e):c<0?(h+=o*((e<<1)+3)-v*(u-1),c+=p*++e-s*((u--<<1)-3)):(c-=s*((u<<1)-3),h-=v*--u),l&&u>=k&&this._mkOvQds(w,d,e,u,1,1,b,y),l=!l}function _mkRect(n,t,i,r){var u=this.stroke;this._mkDiv(n,t,i,u),this._mkDiv(n+i,t,u,r),this._mkDiv(n,t+r,i+u,u),this._mkDiv(n,t+u,u,r-u)}function _mkRectDott(n,t,i,r){this.drawLine(n,t,n+i,t),this.drawLine(n+i,t,n+i,t+r),this.drawLine(n,t+r,n+i,t+r),this.drawLine(n,t,n,t+r)}function jsgFont(){this.PLAIN="font-weight:normal;",this.BOLD="font-weight:bold;",this.ITALIC="font-style:italic;",this.ITALIC_BOLD=this.ITALIC+this.BOLD,this.BOLD_ITALIC=this.ITALIC_BOLD}function jsgStroke(){this.DOTTED=-1}function jsGraphics(n,t){this.setColor=function(n){this.color=n.toLowerCase()},this.setStroke=function(n){this.stroke=n,n+1?n-1>0?(this.drawLine=_mkLin2D,this._mkOv=_mkOv2D,this.drawRect=_mkRect):(this.drawLine=_mkLin,this._mkOv=_mkOv,this.drawRect=_mkRect):(this.drawLine=_mkLinDott,this._mkOv=_mkOvDott,this.drawRect=_mkRectDott)},this.setPrintable=function(n){this.printable=n,jg_fast?(this._mkDiv=_mkDivIe,this._htmRpc=n?_htmPrtRpc:_htmRpc):this._mkDiv=n?_mkDivPrt:_mkDiv},this.setFont=function(n,t,i){this.ftFam=n,this.ftSz=t,this.ftSty=i||Font.PLAIN},this.drawPolyline=this.drawPolyLine=function(n,t){for(var i=n.length-1;i;)--i,this.drawLine(n[i],t[i],n[i+1],t[i+1])},this.fillRect=function(n,t,i,r){this._mkDiv(n,t,i,r)},this.drawPolygon=function(n,t){this.drawPolyline(n,t),this.drawLine(n[n.length-1],t[n.length-1],n[0],t[0])},this.drawEllipse=this.drawOval=function(n,t,i,r){this._mkOv(n,t,i,r)},this.fillEllipse=this.fillOval=function(n,t,i,r){var a=i>>1,f=r>>1,nt=i&1,b=r&1,k=n+a,v=t+f,e=0,u=f,h=f,s=a*a<<1,d=s<<1,o=f*f<<1,g=o<<1,c=(s>>1)*(1-(f<<1))+o,l=(o>>1)-s*((f<<1)-1),w,p,y;if(i)while(u>0)c<0?(c+=o*((e<<1)+3),l+=g*++e):l<0?(c+=o*((e<<1)+3)-d*(u-1),w=k-e,p=(e<<1)+nt,l+=g*++e-s*((u--<<1)-3),y=h-u,this._mkDiv(w,v-h,p,y),this._mkDiv(w,v+u+b,p,y),h=u):(l-=s*((u<<1)-3),c-=d*--u);this._mkDiv(k-a,v-h,i,(h<<1)+b)},this.fillArc=function(n,t,i,r,u,f){var k=i>>1,c=r>>1,w=i&1|(r&1)<<16,h=n+k,s=t+c,o=0,e=c,tt=o,b=e,p=k*k<<1,ut=p<<1,v=c*c<<1,ft=v<<1,nt=(p>>1)*(1-(c<<1))+v,g=(v>>1)-p*((c<<1)-1),ot,it,et,d,y=1<<(Math.floor((u%=360)/180)<<3)|2<<(Math.floor((f%=360)/180)<<3)|(u>=f)<<16,a=new Array(c+1),l=new Array(c+1),rt;for(u*=Math.PI/180,f*=Math.PI/180,ot=h+Math.round(k*Math.cos(u)),it=s+Math.round(-c*Math.sin(u)),_mkLinVirt(a,h,s,ot,it),et=h+Math.round(k*Math.cos(f)),d=s+Math.round(-c*Math.sin(f)),_mkLinVirt(l,h,s,et,d);e>0;)nt<0?(nt+=v*((o<<1)+3),g+=ft*++o):g<0?(nt+=v*((o<<1)+3)-ut*(e-1),tt=o,g+=ft*++o-p*((e--<<1)-3),this._mkArcDiv(tt,e,b,h,s,w,a,l,y),b=e):(g-=p*((e<<1)-3),nt-=ut*--e,e&&(a[e]!=a[e-1]||l[e]!=l[e-1])&&(this._mkArcDiv(o,e,b,h,s,w,a,l,y),tt=o,b=e));this._mkArcDiv(o,0,b,h,s,w,a,l,y),w>>16&&(y>>16?(rt=it<=s||d>s?h-o:h,this._mkDiv(rt,s,o+h-rt+(w&65535),1)):y&1&&d>s&&this._mkDiv(h-o,s,o,1))},this.fillPolygon=function(n,t){var i,r,a,c,o,u,v,f,h,s,y,l=n.length,e;if(l){for(a=t[0],c=t[0],i=1;i<l;i++)t[i]<a&&(a=t[i]),t[i]>c&&(c=t[i]);for(r=a;r<=c;r++){for(e=[],y=0,i=0;i<l;i++){if(i?(h=i-1,s=i):(h=l-1,s=0),u=t[h],f=t[s],u<f)o=n[h],v=n[s];else if(u>f)f=t[h],u=t[s],v=n[h],o=n[s];else continue;r>=u&&r<f?e[y++]=Math.round((r-u)*(v-o)/(f-u)+o):r==c&&r>u&&r<=f&&(e[y++]=Math.round((r-u)*(v-o)/(f-u)+o))}for(e.sort(_CompInt),i=0;i<y;i+=2)this._mkDiv(e[i],r,e[i+1]-e[i]+1,1)}}},this.drawString=function(n,t,i){this.htm+='<div style="position:absolute;white-space:nowrap;left:'+t+"px;top:"+i+"px;font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+n+"</div>"},this.drawStringRect=function(n,t,i,r,u){this.htm+='<div style="position:absolute;overflow:hidden;left:'+t+"px;top:"+i+"px;width:"+r+"px;text-align:"+u+";font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+n+"</div>"},this.drawImage=function(n,t,i,r,u,f){this.htm+='<div style="position:absolute;left:'+t+"px;top:"+i+"px;"+(r?"width:"+r+"px;":"")+(u?"height:"+u+"px;":"")+'"><img src="'+n+'"'+(r?' width="'+r+'"':"")+(u?' height="'+u+'"':"")+(f?" "+f:"")+"></div>"},this.clear=function(){this.htm="",this.cnv&&(this.cnv.innerHTML="")},this._mkOvQds=function(n,t,i,r,u,f,e,o){var h=n-i,s=n+i+e-u,l=t-r,c=t+r+o-f;s>h+u?(this._mkDiv(s,l,u,f),this._mkDiv(s,c,u,f)):u=s-h+u,this._mkDiv(h,l,u,f),this._mkDiv(h,c,u,f)},this._mkArcDiv=function(n,t,i,r,u,f,e,o,s){var v=r+n+(f&65535),a,l=i-t,c,y,h;l||(l=1),n=r-n,s&16711680?(a=u-t-l,s&255?(s&2&&(c=Math.max(n,o[t]),h=v-c,h>0&&this._mkDiv(c,a,h,l)),s&1&&(y=Math.min(v,e[t]),h=y-n,h>0&&this._mkDiv(n,a,h,l))):this._mkDiv(n,a,v-n,l),a=u+t+(f>>16),s&65280?(s&256&&(c=Math.max(n,e[t]),h=v-c,h>0&&this._mkDiv(c,a,h,l)),s&512&&(y=Math.min(v,o[t]),h=y-n,h>0&&this._mkDiv(n,a,h,l))):this._mkDiv(n,a,v-n,l)):(s&255&&(c=s&2?Math.max(n,o[t]):n,y=s&1?Math.min(v,e[t]):v,a=u-t-l,h=y-c,h>0&&this._mkDiv(c,a,h,l)),s&65280&&(c=s&256?Math.max(n,e[t]):n,y=s&512?Math.min(v,o[t]):v,a=u+t+(f>>16),h=y-c,h>0&&this._mkDiv(c,a,h,l)))},this.setStroke(1),this.setFont("verdana,geneva,helvetica,sans-serif","12px",Font.PLAIN),this.color="#000000",this.htm="",this.wnd=t||window,jg_ok||_chkDHTM(this.wnd),jg_ok?n?(this.cont=typeof n=="string"?document.all?this.wnd.document.all[n]||null:document.getElementById?this.wnd.document.getElementById(n)||null:null:n==window.document?document.getElementsByTagName("body")[0]:n,this.cnv=this.wnd.document.createElement("div"),this.cnv.style.fontSize=0,this.cont.appendChild(this.cnv),this.paint=jg_dom?_pntCnvDom:_pntCnvIe):this.paint=_pntDoc:this.paint=_pntN,this.setPrintable(!1)}function _mkLinVirt(n,t,i,r,u){var o=Math.abs(r-t),h=Math.abs(u-i),c=t,p=i,y=t>r?-1:1,v=i>u?-1:1,f,s=0,e,l,a;if(o>=h)for(e=h<<1,l=e-(o<<1),f=e-o;o>0;)--o,f>0?(n[s++]=c,p+=v,f+=l):f+=e,c+=y;else for(e=o<<1,l=e-(h<<1),f=e-h;h>0;)--h,p+=v,n[s++]=c,f>0?(c+=y,f+=l):f+=e;for(a=n.length,s=a-s;s;)n[a-s--]=c}function _CompInt(n,t){return n-t}function get_markerInfoWindowTemplate(){return"<table><tr><td valign='top' onclick=\"window.open('AdUrl')\"><img style='width:100px; height:100px; cursor:pointer' alt='' src='ImageUrl' /> <br /></td><td valign='top'><table><tr><td>Объект:</td><td class='srchResVal'>AdInfo</td></tr><tr><td><b class='priceTitle'>Цена:</b></td><td width='100%' class='price'><b>Price</b></td></tr><tr><td>Адрес:</td><td class='srchResVal'>Address</td></tr><tr><td><label style='color:Maroon; cursor:pointer; text-decoration:underline' title='Открыть информацию об объекте в отдельном окне' onclick=\"window.open('AdUrl')\">Подробнее</label></td><td><label class='findAdInResultsList' ad-id='AdId' style='color:Maroon; cursor:pointer; text-decoration:underline' title='Найти объект в списке результатов поиска' onclick=\"FindAdFunctionName('AdId')\" >К списку результатов</label></td></tr></table></td></tr></table>"}var jg_ok,jg_ie,jg_fast,jg_dom,jg_moz,_regex=/%%([^;]+);([^;]+);([^;]+);([^;]+);([^;]+);/g,Font=new jsgFont,Stroke=new jsgStroke;Coordinates=function(n,t){this.Latitude=n,this.Longitude=t},YandexMapControl=function(n,t,i,r){this.mapContainer=n,this.mapCenter=t,this.mapScale=i,r!==undefined&&(this.mapMode=r.mapMode,this.markerImage=r.markerImage,this.approxMarkerImage=r.approxMarkerImage,this.showMarkerInfoWindow=r.showMarkerInfoWindow,this.findAdInResultsListFunctionName=r.findAdInResultsListFunctionName),this.showMarkerInfoWindow===undefined&&(this.showMarkerInfoWindow=!0),this.markerImage===undefined&&(this.markerImage="/Images/MapIcons/apartment.gif",this.approxMarkerImage="/Images/MapIcons/apartmentApprox.gif"),this._yMap=null,this._selectedAreas=[],this._selectedRegions=[]},YandexMapControl.prototype={isAccessible:function(){return typeof YMaps!="undefined"},isLoaded:function(){return this._isLoaded==!0},load:function(){var n=this;if(this.mapContainer!==undefined&&this.mapCenter!==undefined&&this.mapScale!==undefined){if(!this.isAccessible()){alert("Карты Yandex map в настоящее время недоступены. Попробуйте через несколько минут.");return}if(this.mapContainer.show(),this._isLoaded&&this.mapMode=="search"){n.initRegionEditor();return}n._yMap=new YMaps.Map(n.mapContainer[0]),n._yMap.enableScrollZoom(),n._yMap.setCenter(new YMaps.GeoPoint(n.mapCenter.Longitude,n.mapCenter.Latitude),n.mapScale),this.mapMode=="search"&&n.initRegionEditor(),n._buildLayout(),n._markers&&this.addMarkers(n._markers),this.addedSelectedRegions&&(this._drawAddedSelectedRegions(),this.addedSelectedRegions=null),n._infoText&&!n._messageShown&&(n._yMap.openBalloon(n._yMap.getCenter(),n._infoText,{hasCloseButton:!0}),n._messageShown=!0),n._isLoaded=!0}},hideCanvas:function(){this._regionEditor.hideCanvas()},showCanvas:function(){this._regionEditor.showCanvas()},addMarkers:function(n){var t,i;if(n&&this.isAccessible()&&(t=this,t._markers=n,t._yMap!==undefined&&t._yMap!=null))for(i=0;i<t._markers.length;i++)t._yMap.addOverlay(t._createMarker(t._markers[i],!1))},addMarkerForEditing:function(n,t){var r=this._createMarker(n,!0),i=this;YMaps.Events.observe(r,r.Events.DragEnd,function(){i._draggedMarker=n;var f=r.getCoordPoint();i._newLatLng=f,i._btnSaveLocation&&i._btnSaveLocation.enable(),t(new Coordinates(f.getLat(),f.getLng()))}),i._yMap.addOverlay(r)},showMarkerInfo:function(n){for(var r=this,t,i=0;i<r._markers.length;i++)t=r._markers[i],t.AdId==n&&r._yMap.openBalloon(new YMaps.GeoPoint(t.Coordinates.Longitude,t.Coordinates.Latitude),t.InfoWindowHtml)},getSelectedRegions:function(){for(var i=[],t=this._selectedRegions,n=0;n<t.length;n++)i.push({TopLat:t[n].Top.Lat,TopLng:t[n].Top.Lng,BottomLat:t[n].Bottom.Lat,BottomLng:t[n].Bottom.Lng});return i},addSelectedRegions:function(n){this.addedSelectedRegions=n},_drawAddedSelectedRegions:function(){for(var t=this.addedSelectedRegions,i,n=0;n<t.length;n++)i={Top:{Lat:t[n].TopLat,Lng:t[n].TopLng},Bottom:{Lat:t[n].BottomLat,Lng:t[n].BottomLng}},this._drawRegion(i.Top,i.Bottom)},initRegionEditor:function(){var n=this;this._regionEditor&&this._regionEditor.dispose(),this._regionEditor=new RegionEditor(n.mapContainer,function(t,i){n.onRegionEditingStopped(t,i)})},_buildLayout:function(){var n=this,r,t,i;n._yMap.addControl(new YMaps.TypeControl([YMaps.MapType.MAP,YMaps.MapType.SATELLITE,YMaps.MapType.HYBRID],[0,1,2])),n._yMap.addControl(new YMaps.Zoom),n._yMap.addControl(new YMaps.ScaleLine),r=new YMaps.ToolBar([new YMaps.ToolBar.MoveButton,new YMaps.ToolBar.MagnifierButton,new YMaps.ToolBar.RulerButton,new YMaps.ToolBarSeparator(20)]),n.mapMode=="search"?(t=new YMaps.ToolBarButton({caption:"Редактировать",hint:"Перейти в режим редактирования областей на карте"}),YMaps.Events.observe(t,t.Events.Click,function(){n._regionEditor.isCanvasVisible()?(t.deselect(),n._regionEditor.dispose()):(t.select(),n.initRegionEditor(),n._regionEditor.showCanvas())},n._yMap),i=new YMaps.ToolBarButton({caption:"Очистить",hint:"Удалить с карты все выделенные области"}),YMaps.Events.observe(i,i.Events.Click,function(){for(x in n._selectedAreas)n._yMap.removeOverlay(n._selectedAreas[x]);n._selectedAreas=[],n._selectedRegions=[]},n._yMap),r.add(t),r.add(i)):n.mapMode=="edit",n._yMap.addControl(r)},_createMarker:function(n,t){var r=new YMaps.Style,u,i,f;return r.iconStyle=new YMaps.IconStyle,r.iconStyle.href=!n.isApproxCoord&&this.markerImage?this.markerImage:n.isApproxCoord&&this.approxMarkerImage?this.approxMarkerImage:this.markerImage,r.iconStyle.size=new YMaps.Point(30,50),r.hasHint=!0,u=new YMaps.Placemark(new YMaps.GeoPoint(n.Coordinates.Longitude,n.Coordinates.Latitude),{style:r,draggable:t}),n.AdInfo&&(u.name=n.AdInfo+", "+n.Address,u.description=n.AdInfo+", "+n.Address),this.showMarkerInfoWindow&&(i=get_markerInfoWindowTemplate(),i=i.replace(/AdUrl/g,n.AdUrl),i=i.replace(/ImageUrl/g,n.ImageUrl),i=i.replace(/AdInfo/g,n.AdInfo),i=i.replace(/Price/g,n.Price),i=i.replace(/Address/g,n.Address),i=i.replace(/AdId/g,n.AdId),i=i.replace(/FindAdFunctionName/g,this.findAdInResultsListFunctionName),n.InfoWindowHtml=i,f=new YMaps.Template(n.InfoWindowHtml),r.balloonContentStyle=new YMaps.BalloonContentStyle(f)),n.gMarker=u,u},onRegionEditingStopped:function(n,t){var u=new YMaps.Point(n.x,n.y),f=new YMaps.Point(t.x,t.y),i=this._yMap.converter.localPixelsToCoordinates(u),r=this._yMap.converter.localPixelsToCoordinates(f),u={Lat:i.getLat(),Lng:i.getLng()},f={Lat:r.getLat(),Lng:r.getLng()};this._drawRegion(u,f)},_drawRegion:function(n,t){var u=new YMaps.Polygon([new YMaps.GeoPoint(n.Lng,n.Lat),new YMaps.GeoPoint(t.Lng,n.Lat),new YMaps.GeoPoint(t.Lng,t.Lat),new YMaps.GeoPoint(n.Lng,t.Lat),new YMaps.GeoPoint(n.Lng,n.Lat)]),i=new YMaps.Style,r;i.polygonStyle=new YMaps.PolygonStyle,i.polygonStyle.fill=!1,i.polygonStyle.outline=!0,i.polygonStyle.strokeWidth=2,i.polygonStyle.strokeColor="2014ffff",u.setStyle(i),r=this._selectedAreas.length,this._selectedRegions[r]={Top:n,Bottom:t},this._selectedAreas[r]=u,this._yMap.addOverlay(u)}},RegionEditor=function(n,t){var i=this;i._startPosition=null,i._endPosition=null,i._isDragStarted=!1,i.onEditingFinished=t,i.mapContainer=n,i.buildCanvas()},RegionEditor.prototype={buildCanvas:function(){var n=this;n._canvas=n._initCanvas(n.mapContainer),n._canvasTop=Util.getElementPosition(n.mapContainer[0],10),n._canvas[0].onmousedown=function(t){n.onMouseDown(t)},n._canvas[0].onmouseup=function(t){n.onMouseUp(t)},n._canvas[0].onmousemove=function(t){n.onMouseMove(t)},n._jsGraphics=new jsGraphics(n._canvas[0].id),n._jsGraphics.setStroke(3),n._jsGraphics.setColor("#ff0000"),n._canvasVisible=!1},paint:function(){},dispose:function(){this._canvasVisible=!1,this._canvas.remove()},showCanvas:function(){this._canvasVisible=!0,this._canvas.show()},isCanvasVisible:function(){return this._canvasVisible},hideCanvas:function(){this._canvasVisible=!1,this._canvas.remove()},_initCanvas:function(n){var t=$('<div id="div_Map_Canvas"></div>');return t.css("cursor","crosshair"),t.css("position","absolute"),t.css("overflow","hidden"),t.css("z-index","101"),t.css("top","0px"),t.css("left","0px"),t.css("background-color","#ffffff"),t.css("filter","alpha(opacity=30)"),t.css("opacity","0.30"),t.css("height",n.css("height")),t.css("width",n.css("width")),t.hide(),t.appendTo(n),t},onMouseDown:function(n){this._isDragStarted=!0;var t=Util.getMousePositionInDocument(n);this._startPosition=Util.calculatePosition(t,this._canvasTop),this._endPosition=null,navigator.appName=="Microsoft Internet Explorer"&&cancel_Bubble()},onMouseUp:function(){var t=this,r,i;if(t._isDragStarted){if(t._isDragStarted=!1,start=t._startPosition,stop=t._endPosition,!stop)return;start.x<stop.x&&start.y<stop.y?(r=start,i=stop):start.x>stop.x&&start.y<stop.y?(r={x:stop.x,y:start.y},i={x:start.x,y:stop.y}):start.x>stop.x&&start.y>stop.y?(r=stop,i=start):start.x<stop.x&&start.y>stop.y&&(r={x:start.x,y:stop.y},i={x:stop.x,y:start.y});t.onEditingFinished(r,i);t._jsGraphics.clear()}},onMouseMove:function(n){var f,e;if(this._isDragStarted){navigator.appName=="Microsoft Internet Explorer"&&cancel_Bubble(),f=this,e=Util.getMousePositionInDocument(n),f._endPosition=Util.calculatePosition(e,f._canvasTop);var t=f._startPosition,i=f._jsGraphics,r=f._endPosition.x-t.x,u=f._endPosition.y-t.y;i.clear(),r<0&&u<0?(i.drawRect(t.x+r,t.y+u,-r,-u),i.paint()):r<0?(i.drawRect(t.x+r,t.y,-r,u),i.paint()):u<0?(i.drawRect(t.x,t.y+u,r,-u),i.paint()):(i.drawRect(t.x,t.y,r,u),i.paint())}}}